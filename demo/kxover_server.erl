% kxover_server.erl
%
% This is a generated file.  Do not edit it, but rather its source and
% run perpetuum to produce a new version of this file.
%
% Please file issues with https://github.com/vanrein/perpetuum/issues
%
% With compliments from the ARPA2.net / InternetWide.org project and
% from SURFnet!
%

-module( 'kxover_server' ).
-behaviour( gen_perpetuum ).

-export([
	start_link/3, start/3,
	stop/1, stop/2,
	transit/0, places/0,
	initial_placebits/0, initial_marking/1,
	transmap/1, sentinel/1
]).


% Transitions in their standard order of occurrence
%
transit() -> [ 'recv_KX_req', 'got_TLSA', 'expiration_timer', 'got_SRV', 'failed_SRV', 'ecdhe2krbtgt', 'send_KX_resp', 'cache_exp_timer', 'remove_shortest', 'dnssec_req_TLSA', 'signature_good', 'dnssec_req_SRV', 'signature_error', 'successfulEnd', 'send_KX_failed', 'store_krbtgt_kdb', 'failed_TLSA' ].

% Places in their standard order of occurrence
%
places() -> [ 'building_krbtgt', 'lookup_DANE', 'want_cert', 'success', 'welcome', 'failedCached', 'ready_to_send', 'failed', 'have_krbtgt', 'lookup_kdc', 'want_kdc', 'keyed_remote', 'servicing' ].


% Initial bitfield vector is 60 or N*64 bits long, N>=3, with
% 15 bits for all of the 13 places,
% and the sign bit to spare for possible future use with timeouts.


% Return the initial place bits for this Petri Net.
%
initial_placebits() -> 3.


% Return the initial marking for this Petri Net,
% parameterised with the number of place bits,
% even though we have no current use for it.
%
initial_marking( 3 ) -> 0.


% Return a transmap beyond N bit integers; initially, N=%d.
% The transmap is only read and usually remains literal;
% Only very large Petri Nets need to scale up dynamically.
%
transmap(    3 ) -> #{
			'recv_KX_req' => { 282574488338432, 0, 4372244638238856 },
			'got_TLSA' => { 17592186044416, 16, 2401919801264264 },
			'expiration_timer' => { 0, 4294967296, 2401919801264264 },
			'got_SRV' => { 256, 68719476736, 2401919801264264 },
			'failed_SRV' => { 268435456, 68719476736, 2401919801264264 },
			'ecdhe2krbtgt' => { 1, 65536, 2401919801264264 },
			'send_KX_resp' => { 4096, 16777216, 2401919801264264 },
			'cache_exp_timer' => { 0, 281474977759232, 2401919801264264 },
			'remove_shortest' => { 8589934592, 12884901888, 2401919801264264 },
			'dnssec_req_TLSA' => { 16, 256, 2401919801264264 },
			'signature_good' => { 65536, 17592186044416, 2401919801264264 },
			'dnssec_req_SRV' => { 68719476736, 1099511627776, 2401919801264264 },
			'signature_error' => { 268435456, 17592186044416, 2401919801264264 },
			'successfulEnd' => { 0, 281474976714752, 2401919801264264 },
			'send_KX_failed' => { 1048576, 268435456, 2401919801264264 },
			'store_krbtgt_kdb' => { 4311744512, 1, 2401919801264264 },
			'failed_TLSA' => { 268435456, 16, 2401919801264264 }
	};
transmap(   13 ) -> #{
			'recv_KX_req' => { 374144420550507721968307263521350845072441325125632, 0, 6129795102672655560332883339394682169193946634231226368 },
			'got_TLSA' => { 22835963083295358096932575511191922182123945984, 16384, 3065178165360034554763249428411239170409500308595023872 },
			'expiration_timer' => { 0, 5192296858534827628530496329220096, 3065178165360034554763249428411239170409500308595023872 },
			'got_SRV' => { 268435456, 85070591730234615865843651857942052864, 3065178165360034554763249428411239170409500308595023872 },
			'failed_SRV' => { 316912650057057350374175801344, 85070591730234615865843651857942052864, 3065178165360034554763249428411239170409500308595023872 },
			'ecdhe2krbtgt' => { 1, 72057594037927936, 3065178165360034554763249428411239170409500308595023872 },
			'send_KX_resp' => { 4398046511104, 19342813113834066795298816, 3065178165360034554763249428411239170409500308595023872 },
			'cache_exp_timer' => { 0, 374144419156711147060143317176549044652636142305280, 3065178165360034554763249428411239170409500308595023872 },
			'remove_shortest' => { 10384593717069655257060992658440192, 15576890575604482885591488987660288, 3065178165360034554763249428411239170409500308595023872 },
			'dnssec_req_TLSA' => { 16384, 268435456, 3065178165360034554763249428411239170409500308595023872 },
			'signature_good' => { 72057594037927936, 22835963083295358096932575511191922182123945984, 3065178165360034554763249428411239170409500308595023872 },
			'dnssec_req_SRV' => { 85070591730234615865843651857942052864, 1393796574908163946345982392040522594123776, 3065178165360034554763249428411239170409500308595023872 },
			'signature_error' => { 316912650057057350374175801344, 22835963083295358096932575511191922182123945984, 3065178165360034554763249428411239170409500308595023872 },
			'successfulEnd' => { 0, 374144419156711147060143317175368453036316777512960, 3065178165360034554763249428411239170409500308595023872 },
			'send_KX_failed' => { 1180591620717411303424, 316912650057057350374175801344, 3065178165360034554763249428411239170409500308595023872 },
			'store_krbtgt_kdb' => { 5192296877877640742364563124518912, 1, 3065178165360034554763249428411239170409500308595023872 },
			'failed_TLSA' => { 316912650057057350374175801344, 16384, 3065178165360034554763249428411239170409500308595023872 }
	};
transmap(   18 ) -> #{
			'recv_KX_req' => { 431359146675979512148518911583273038133996227364674748558773772615680, 0, 226156208612471233905513237773377839318513980914052669183720473396078968832 },
			'got_TLSA' => { 822752278660603021077484591278675252491367932816789931674304512, 524288, 113078427825801311222418912398072446619645789708323816513097374171115290624 },
			'expiration_timer' => { 0, 5708990770823839524233143877797980545530986496, 113078427825801311222418912398072446619645789708323816513097374171115290624 },
			'got_SRV' => { 274877906944, 2993155353253689176481146537402947624255349848014848, 113078427825801311222418912398072446619645789708323816513097374171115290624 },
			'failed_SRV' => { 10889035741470030830827987437816582766592, 2993155353253689176481146537402947624255349848014848, 113078427825801311222418912398072446619645789708323816513097374171115290624 },
			'ecdhe2krbtgt' => { 1, 75557863725914323419136, 113078427825801311222418912398072446619645789708323816513097374171115290624 },
			'send_KX_resp' => { 144115188075855872, 20769187434139310514121985316880384, 113078427825801311222418912398072446619645789708323816513097374171115290624 },
			'cache_exp_timer' => { 0, 431359146674410236714672241392314090778233924841906291866454535962624, 113078427825801311222418912398072446619645789708323816513097374171115290624 },
			'remove_shortest' => { 11417981541647679048466287755595961091061972992, 17126972312471518572699431633393941636592959488, 113078427825801311222418912398072446619645789708323816513097374171115290624 },
			'dnssec_req_TLSA' => { 524288, 274877906944, 113078427825801311222418912398072446619645789708323816513097374171115290624 },
			'signature_good' => { 75557863725914323419136, 822752278660603021077484591278675252491367932816789931674304512, 113078427825801311222418912398072446619645789708323816513097374171115290624 },
			'dnssec_req_SRV' => { 2993155353253689176481146537402947624255349848014848, 1569275433846670190958947355801916604025588861116008628224, 113078427825801311222418912398072446619645789708323816513097374171115290624 },
			'signature_error' => { 10889035741470030830827987437816582766592, 822752278660603021077484591278675252491367932816789931674304512, 113078427825801311222418912398072446619645789708323816513097374171115290624 },
			'successfulEnd' => { 0, 431359146674410236714672241392314090778194310760649303812845839843328, 113078427825801311222418912398072446619645789708323816513097374171115290624 },
			'send_KX_failed' => { 39614081257132168796771975168, 10889035741470030830827987437816582766592, 113078427825801311222418912398072446619645789708323816513097374171115290624 },
			'store_krbtgt_kdb' => { 5708990770844608711667283188312102530847866880, 1, 113078427825801311222418912398072446619645789708323816513097374171115290624 },
			'failed_TLSA' => { 10889035741470030830827987437816582766592, 524288, 113078427825801311222418912398072446619645789708323816513097374171115290624 }
	};
transmap(   23 ) -> #{
			'recv_KX_req' => { 497323236409788409002447026531150423397956893715863544924360852512117618618734668152832, 0, 8343699110404451625850538262091748432480096899144696286236290841448208870150275030740270841856 },
			'got_TLSA' => { 29642774844752946028434172162224104410437116074403984394101141506025761187823616, 16777216, 4171849928194660530959403647611590105467529729373009642281192641634412861394458469010048548864 },
			'expiration_timer' => { 0, 6277101735386680763835789423207666416102355444464034512896, 4171849928194660530959403647611590105467529729373009642281192641634412861394458469010048548864 },
			'got_SRV' => { 281474976710656, 105312291668557186697918027683670432318895095400549111254310977536, 4171849928194660530959403647611590105467529729373009642281192641634412861394458469010048548864 },
			'failed_SRV' => { 374144419156711147060143317175368453031918731001856, 105312291668557186697918027683670432318895095400549111254310977536, 4171849928194660530959403647611590105467529729373009642281192641634412861394458469010048548864 },
			'ecdhe2krbtgt' => { 1, 79228162514264337593543950336, 4171849928194660530959403647611590105467529729373009642281192641634412861394458469010048548864 },
			'send_KX_resp' => { 4722366482869645213696, 22300745198530623141535718272648361505980416, 4171849928194660530959403647611590105467529729373009642281192641634412861394458469010048548864 },
			'cache_exp_timer' => { 0, 497323236409786642155382248146820840100456150797349046668459761809032400819593655877632, 4171849928194660530959403647611590105467529729373009642281192641634412861394458469010048548864 },
			'remove_shortest' => { 12554203470773361527671578846415332832204710888928069025792, 18831305206160042291507368269622999248307066333392103538688, 4171849928194660530959403647611590105467529729373009642281192641634412861394458469010048548864 },
			'dnssec_req_TLSA' => { 16777216, 281474976710656, 4171849928194660530959403647611590105467529729373009642281192641634412861394458469010048548864 },
			'signature_good' => { 79228162514264337593543950336, 29642774844752946028434172162224104410437116074403984394101141506025761187823616, 4171849928194660530959403647611590105467529729373009642281192641634412861394458469010048548864 },
			'dnssec_req_SRV' => { 105312291668557186697918027683670432318895095400549111254310977536, 1766847064778384329583297500742918515827483896875618958121606201292619776, 4171849928194660530959403647611590105467529729373009642281192641634412861394458469010048548864 },
			'signature_error' => { 374144419156711147060143317175368453031918731001856, 29642774844752946028434172162224104410437116074403984394101141506025761187823616, 4171849928194660530959403647611590105467529729373009642281192641634412861394458469010048548864 },
			'successfulEnd' => { 0, 497323236409786642155382248146820840100456150797347717440463976897881863495403020746752, 4171849928194660530959403647611590105467529729373009642281192641634412861394458469010048548864 },
			'send_KX_failed' => { 1329227995784915872903807060280344576, 374144419156711147060143317175368453031918731001856, 4171849928194660530959403647611590105467529729373009642281192641634412861394458469010048548864 },
			'store_krbtgt_kdb' => { 6277101735386703064580987953830807951820628092825540493312, 1, 4171849928194660530959403647611590105467529729373009642281192641634412861394458469010048548864 },
			'failed_TLSA' => { 374144419156711147060143317175368453031918731001856, 16777216, 4171849928194660530959403647611590105467529729373009642281192641634412861394458469010048548864 }
	};
transmap(   28 ) -> #{
			'recv_KX_req' => { 573374653997517879891998169464668303820670239879353641336221813036121588783977109590142626327664923770880, 0, 307828173122644542381167821805893366210426737552025509991798555408513584772095231461134396941724210040073927786496 },
			'got_TLSA' => { 1067993517960455041197510853084776057301352261178326384973520803911109862890320275011481043468288, 536870912, 153914086991353261955720699317412598609855741225911106237195815232575943948914971532418621401084646595704458838016 },
			'expiration_timer' => { 0, 6901746346790563787434755862277025452451108972170386555162524223799296, 153914086991353261955720699317412598609855741225911106237195815232575943948914971532418621401084646595704458838016 },
			'got_SRV' => { 288230376151711744, 3705346855594118253554271520278013051304639509300498049262642688253220148477952, 153914086991353261955720699317412598609855741225911106237195815232575943948914971532418621401084646595704458838016 },
			'failed_SRV' => { 12855504354071922204335696738729300820177623950262342682411008, 3705346855594118253554271520278013051304639509300498049262642688253220148477952, 153914086991353261955720699317412598609855741225911106237195815232575943948914971532418621401084646595704458838016 },
			'ecdhe2krbtgt' => { 1, 83076749736557242056487941267521536, 153914086991353261955720699317412598609855741225911106237195815232575943948914971532418621401084646595704458838016 },
			'send_KX_resp' => { 154742504910672534362390528, 23945242826029513411849172299223580994042798784118784, 153914086991353261955720699317412598609855741225911106237195815232575943948914971532418621401084646595704458838016 },
			'cache_exp_timer' => { 0, 573374653997517877902705223825521735199141247292070280934397254448221116083367485088941183574254433599488, 153914086991353261955720699317412598609855741225911106237195815232575943948914971532418621401084646595704458838016 },
			'remove_shortest' => { 13803492693581127574869511724554050904902217944340773110325048447598592, 20705239040371691362304267586831076357353326916511159665487572671397888, 153914086991353261955720699317412598609855741225911106237195815232575943948914971532418621401084646595704458838016 },
			'dnssec_req_TLSA' => { 536870912, 288230376151711744, 153914086991353261955720699317412598609855741225911106237195815232575943948914971532418621401084646595704458838016 },
			'signature_good' => { 83076749736557242056487941267521536, 1067993517960455041197510853084776057301352261178326384973520803911109862890320275011481043468288, 153914086991353261955720699317412598609855741225911106237195815232575943948914971532418621401084646595704458838016 },
			'dnssec_req_SRV' => { 3705346855594118253554271520278013051304639509300498049262642688253220148477952, 1989292945639146568621528992587283360401824603189390869761855907572637988050133502132224, 153914086991353261955720699317412598609855741225911106237195815232575943948914971532418621401084646595704458838016 },
			'signature_error' => { 12855504354071922204335696738729300820177623950262342682411008, 1067993517960455041197510853084776057301352261178326384973520803911109862890320275011481043468288, 153914086991353261955720699317412598609855741225911106237195815232575943948914971532418621401084646595704458838016 },
			'successfulEnd' => { 0, 573374653997517877902705223825521735199141247292070280934397209846730719022121356760009548950065784029184, 153914086991353261955720699317412598609855741225911106237195815232575943948914971532418621401084646595704458838016 },
			'send_KX_failed' => { 44601490397061246283071436545296723011960832, 12855504354071922204335696738729300820177623950262342682411008, 153914086991353261955720699317412598609855741225911106237195815232575943948914971532418621401084646595704458838016 },
			'store_krbtgt_kdb' => { 6901746346790563811379998688306538864300281271393967549205323007918080, 1, 153914086991353261955720699317412598609855741225911106237195815232575943948914971532418621401084646595704458838016 },
			'failed_TLSA' => { 12855504354071922204335696738729300820177623950262342682411008, 536870912, 153914086991353261955720699317412598609855741225911106237195815232575943948914971532418621401084646595704458838016 }
	};
transmap(    N ) when N div 64 == 0 ->
		gen_perpetuum:reflow_transmap( transmap( 3 ),13,3,N ).


% Return the sentinel value for a Petri Net of given
% number of place bits.  Again, mostly literal.
%
sentinel(    3 ) -> 2401919801264264;
sentinel(   13 ) -> 3065178165360034554763249428411239170409500308595023872;
sentinel(   18 ) -> 113078427825801311222418912398072446619645789708323816513097374171115290624;
sentinel(   23 ) -> 4171849928194660530959403647611590105467529729373009642281192641634412861394458469010048548864;
sentinel(   28 ) -> 153914086991353261955720699317412598609855741225911106237195815232575943948914971532418621401084646595704458838016;
sentinel(    N ) -> gen_perpetuum:reflow_sentinel( sentinel( 3 ),13,3,N ).


% Construct a new process running kxover_server instances
% as specialisations of the gen_perpetuum behaviour.
%
% Provided parameters are the standard {M,F,A} form for callbacks,
% used for processing transitions under application logic.
%
start_link( CallbackMod,CallbackFun,CallbackArg ) ->
	InitArgs = [ self(),?MODULE,[ CallbackMod,CallbackFun,CallbackArg ] ],
	proc_lib:start_link( gen_perpetuum,init,InitArgs ).
%
start( CallbackMod,CallbackFun,CallbackArg ) ->
	InitArgs = [ self(),?MODULE,[ CallbackMod,CallbackFun,CallbackArg ] ],
	proc_lib:start( gen_perpetuum,init,InitArgs ).


% Stop a running process with a kxover_server instance
%
stop( Pid        ) -> Pid ! { stop,normal }.
stop( Pid,Reason ) -> Pid ! { stop,Reason }.




%% End of generated file kxover_server.erl
